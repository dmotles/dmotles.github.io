/* copyright (c) 2017 Daniel Motles. All Rights Reserved. */
(function(){
'use strict';(function(){function f(a){var b=new XMLHttpRequest;b.open("GET",a.url,!0);b.onreadystatechange=function(){if(4===b.readyState)a.ondone(b)};for(header in a.headers)a.headers.hasOwnProperty(header)&&b.setRequestHeader(header,a.headers[header]);_.isUndefined(a.data)?b.send():b.send(a.data)}function k(a){this.clientid=a}function l(a,b){this.likes=a;this.likeid=0;this.sc=b;this._music_items=Array(a.length-1);for(b=0;b<a.length;b++)this._music_items[b]=null;this._last_playing=null}function d(a){function b(a){var b=
2*Math.PI*Math.random(),e=Math.acos(2*Math.random()-1);return[a*Math.sin(e)*Math.cos(b),a*Math.sin(e)*Math.sin(b),a*Math.cos(e)]}function c(){h.aspect=window.innerWidth/window.innerHeight;h.updateProjectionMatrix();m.setSize(window.innerWidth,window.innerHeight)}function f(){requestAnimationFrame(f);var b=a.getWaveformData();n+=.1;h.position.x=300*Math.sin(THREE.Math.degToRad(n));h.position.y=300*Math.sin(THREE.Math.degToRad(n));h.position.z=300*Math.cos(THREE.Math.degToRad(n));h.lookAt(g.position);
for(var c=0;c<k.length;c++){var e=k[c],d;d=b[c];d=Math.max(-120,d);d=(d+120)/120+.2;e.position.fromArray(p[c]);e.position.multiplyScalar(d)}m.render(g,h)}var d,h,m,g,l=Music.getFFTSize()/2*.8,n=0,k=[],p=[];(function(){d=document.createElement("div");document.body.appendChild(d);h=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1E4);g=new THREE.Scene;var a=new THREE.DirectionalLight(16777215,1);a.position.set(1,1,1).normalize();g.add(a);a=new THREE.DirectionalLight(16777215,1);
a.position.set(-1,-1,-1).normalize();g.add(a);for(var a=new THREE.BoxGeometry(20,20,20),f=0;f<l;f++){var e=new THREE.Mesh(a,new THREE.MeshLambertMaterial({color:16777215*Math.random()}));e.rotation.x=2*Math.random()*Math.PI;e.rotation.y=2*Math.random()*Math.PI;e.rotation.z=2*Math.random()*Math.PI;e.scale.x=Math.random()+.5;e.scale.y=Math.random()+.5;e.scale.z=Math.random()+.5;g.add(e);k.push(e);p.push(b(400))}m=new THREE.WebGLRenderer;m.setClearColor(15790320);m.setSize(window.innerWidth,window.innerHeight);
m.sortObjects=!1;d.appendChild(m.domElement);window.addEventListener("resize",c,!1)})();f()}k.prototype={url:function(a,b){var c=["//api.soundcloud.com/",a,"?client_id=",this.clientid];_.isObject(b)&&_.each(b,function(a,b){c.push("&",encodeURIComponent(b),"=",encodeURIComponent(a))});return c.join("")},resolve:function(a,b){f({url:this.url("resolve.json",{url:a}),ondone:b})},likes:function(a,b){f({url:this.url(["users",a.toString(),"favorites.json"].join("/")),ondone:b})},stream_url:function(a){return a+
"?client_id="+this.clientid},_testlikes:function(a,b){f({url:"/json/favorites.json",ondone:b})}};l.prototype={curmusic:function(){var a=this,b=this._music_items[this.likeid];_.isNull(b)&&(b=new Music(this.curstreamurl()),b.onFinish(function(){a.next()}),this._music_items[this.likeid]=b);return b},curstreamurl:function(){return this.sc.stream_url(this.likes[this.likeid].stream_url)},next:function(){this.curmusic().pause();this.likeid>=this.likes.length?this.likeid=0:this.likeid++;this.curmusic().play()},
prev:function(){this.curmusic().pause();0>=this.likeid?this.likeid=this.likes.length-1:this.likeid--;this.curmusic().play()},togglePlay:function(){this.curmusic().togglePause()},handleEvent:function(a){(is_event_toggle="keyup"===a.type&&32===a.keyCode||"mouseup"===a.type||"touchup"===a.type)?this.togglePlay():(is_next_event="keyup"===a.type&&39===a.keyCode)?this.next():(is_prev_event="keyup"===a.type&&37===a.keyCode)&&this.prev()},getWaveformData:function(){return this.curmusic().getEqData()},isPlaying:function(){return!0}};
var g=new k("d6de0043ca8b2163688482b2bfff11d9");g.likes(27794941,function(a){a=JSON.parse(a.responseText);a=_.shuffle(_.filter(a,function(a){return"track"===a.kind&&a.streamable}));a=new l(a,g);window.document.addEventListener("keyup",a);window.document.addEventListener("mouseup",a);window.document.addEventListener("touchup",a);a.togglePlay();d(a)})})();(function(f,k,l){function d(b){var c=l.createElement("audio");c.crossOrigin="anonymous";c.style.visibility="hidden";c.style.display="none";c.src=b;c.volume=a;l.body.appendChild(c);this.e=c;c.load();this.source=g.createMediaElementSource(c);this.analyser=g.createAnalyser();this.analyser.smoothingTimeConstant=.8;this.analyser.fftSize=1024;this.analyser.minDecibels=-120;this.analyser.maxDecibels=100;this.eqData=new f.Float32Array(this.analyser.frequencyBinCount);this.source.connect(this.analyser);this.analyser.connect(g.destination)}
var g=function(){var a=f.AudioContext||f.webkitAudioContext||null;if(null===a)throw alert("This site will not work in your browser. Please try Chrome or FireFox"),Error("Browser does not support audio contexts (HTML5?)");return new a}(),a=.5;d.prototype={getEqData:function(){this.analyser.getFloatFrequencyData(this.eqData);return this.eqData},play:function(){0<this.e.currentTime&&(this.e.currentTime=0);this.e.volume=a;this.e.play()},togglePause:function(){this.e.paused?(this.e.volume=a,this.e.play()):
this.e.pause()},pause:function(){this.e.pause()},onFinish:function(a){this.e.addEventListener("ended",a,!0)}};d.setVolume=function(b){a=b};d.getFFTSize=function(){return 1024};f.Music=d})(this,_,document);
}).call(this)
